# 客户档案管理系统测试指南

## 1. 筛选和搜索功能测试

### 1.1 搜索功能测试

**测试步骤：**
1. 打开客户列表页面 (`/customers`)
2. 在搜索框中输入客户姓名（如："张"）
3. 验证搜索结果是否正确过滤
4. 清空搜索框，验证是否恢复完整列表
5. 测试模糊搜索（如："小明"）
6. 测试手机号搜索（如：输入部分手机号）

**预期结果：**
- 搜索结果准确匹配关键词
- 搜索不区分大小写
- 搜索结果实时更新
- 清空搜索后显示所有数据

### 1.2 分类筛选测试

**测试步骤：**
1. 在"客户分类"下拉框中选择"成交客户"
2. 验证列表只显示 category='converted' 的客户
3. 测试其他分类：潜在客户、升单潜力、转科潜力、流失预警
4. 清空筛选，验证恢复完整列表

**预期结果：**
- 筛选结果准确匹配选定分类
- 筛选状态正确显示在界面上
- 清空筛选后显示所有数据

### 1.3 产品类型筛选测试

**测试步骤：**
1. 在"产品类型"下拉框中选择"角塑"
2. 验证列表只显示 currentProduct='角塑' 的客户
3. 测试其他产品：框架镜、无
4. 清空筛选，验证恢复完整列表

**预期结果：**
- 筛选结果准确匹配选定产品类型
- 筛选状态正确显示在界面上
- 清空筛选后显示所有数据

### 1.4 年龄范围筛选测试

**测试步骤：**
1. 拖动年龄滑块，设置范围为 5-15 岁
2. 验证列表只显示年龄在此范围内的客户
3. 测试不同的年龄范围组合
4. 重置为默认范围 [0, 20]

**预期结果：**
- 筛选结果准确匹配年龄范围
- 年龄范围标签正确显示当前值
- 重置后显示所有数据

### 1.5 组合筛选测试

**测试步骤：**
1. 同时应用多个筛选条件（分类+产品+年龄）
2. 验证筛选结果的准确性
3. 清空所有筛选条件
4. 验证数据恢复完整

**预期结果：**
- 多个筛选条件正确组合（AND 逻辑）
- 清空任一条件后，结果相应更新
- 清空所有条件后显示完整数据

## 2. 图表渲染性能测试

### 2.1 图表数据缓存测试

**测试步骤：**
1. 打开客户详情页，查看度数增长曲线
2. 刷新页面，观察图表加载时间
3. 切换时间范围，再次查看图表
4. 检查浏览器开发者工具中的 Network 和 Performance 面板

**预期结果：**
- 首次加载图表需要一定时间（模拟API延迟）
- 缓存的图表数据再次加载时速度更快
- 控制台显示缓存命中日志
- 图表数据正确渲染

### 2.2 图表类型切换测试

**测试步骤：**
1. 在客户详情页切换不同图表类型
2. 测试度数曲线、眼轴曲线、视力曲线、综合图表
3. 验证每种图表的数据正确性
4. 检查图表的交互功能（缩放、悬停等）

**预期结果：**
- 图表类型切换流畅
- 每种图表显示正确的数据
- 图表交互功能正常工作

### 2.3 大数据量性能测试

**测试步骤：**
1. 查看有大量检查记录的客户（100+ 条记录）
2. 观察图表渲染性能
3. 测试时间范围筛选功能
4. 检查内存使用情况

**预期结果：**
- 图表渲染流畅，无明显卡顿
- 时间范围筛选响应快速
- 内存使用合理，无内存泄漏

## 3. 响应式布局测试

### 3.1 桌面端测试

**测试步骤：**
1. 在不同分辨率的桌面浏览器中打开页面
2. 测试 1920x1080、1366x768 等分辨率
3. 调整浏览器窗口大小，观察布局变化
4. 验证所有功能按钮和表格的可用性

**预期结果：**
- 布局在各种分辨率下正常显示
- 表格列宽自适应
- 所有功能按钮可正常点击

### 3.2 平板端测试

**测试步骤：**
1. 使用平板设备或浏览器开发者工具模拟平板
2. 测试 768x1024、1024x768 等分辨率
3. 验证表格在小屏幕上的显示效果
4. 测试触摸操作

**预期结果：**
- 表格列合理缩放
- 筛选控件正确堆叠
- 触摸操作响应正常

### 3.3 手机端测试

**测试步骤：**
1. 使用手机或浏览器开发者工具模拟手机
2. 测试 375x667、414x896 等分辨率
3. 验证客户列表的移动端显示
4. 测试触摸滚动和选择功能

**预期结果：**
- 客户列表以卡片形式展示
- 筛选控件自动收起为下拉菜单
- 触摸操作流畅

### 3.4 响应式断点测试

**断点设置：**
- xs: < 576px
- sm: ≥ 576px
- md: ≥ 768px
- lg: ≥ 992px
- xl: ≥ 1200px

**测试步骤：**
1. 在每个断点处验证布局
2. 调整浏览器窗口大小，观察断点变化
3. 验证关键组件在不同断点下的表现

**预期结果：**
- 布局在断点处平滑过渡
- 组件在不同屏幕尺寸下合理调整
- 无布局错乱或重叠

## 4. 权限控制测试

### 4.1 角色权限测试

**测试步骤：**
1. 使用不同角色的账号登录系统
2. 验证各角色在客户列表页看到的客户数量
3. 检查权限提示标签的显示

**预期结果：**

| 角色 | 可查看客户范围 |
|------|----------------|
| medical_assistant | 仅自己负责的客户 |
| optometrist | 仅自己负责的客户 |
| sales | 仅自己负责的客户 |
| manager | 所有客户 |
| executive | 所有客户 |

### 4.2 权限提示测试

**测试步骤：**
1. 以不同角色登录系统
2. 观察页面顶部的权限提示标签
3. 验证提示文本的准确性

**预期结果：**
- 标签显示当前角色名称
- 标签说明权限范围
- 标签颜色为蓝色（info类型）

### 4.3 数据访问测试

**测试步骤：**
1. 以普通员工身份登录
2. 尝试查看非自己负责的客户详情页
3. 验证是否会跳转到错误页面或显示无权限信息

**预期结果：**
- 无法访问非负责的客户数据
- 页面显示权限不足提示
- URL 无法直接访问未授权资源

### 4.4 数据过滤测试

**测试步骤：**
1. 以不同角色登录，观察客户列表
2. 验证筛选、搜索结果是否只包含有权限的客户
3. 测试排序功能是否正常工作

**预期结果：**
- 所有筛选和搜索都在权限范围内进行
- 排序功能不影响权限控制
- 客户总数正确显示

## 5. 性能指标

### 5.1 页面加载性能

**目标指标：**
- 首页加载时间：< 2秒
- 客户列表加载时间：< 1秒
- 客户详情页加载时间：< 1.5秒
- 图表渲染时间：< 500ms

### 5.2 交互性能

**目标指标：**
- 搜索响应时间：< 300ms
- 筛选响应时间：< 300ms
- 分页切换时间：< 200ms
- 图表切换时间：< 500ms

### 5.3 内存使用

**目标指标：**
- 初始内存使用：< 50MB
- 图表页面内存使用：< 100MB
- 无内存泄漏

## 6. 兼容性测试

### 6.1 浏览器兼容性

**测试浏览器：**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**测试项目：**
- 页面渲染
- 功能可用性
- 图表显示
- 响应式布局

### 6.2 设备兼容性

**测试设备：**
- 桌面端：Windows、macOS
- 平板端：iPad、Android Tablet
- 移动端：iOS、Android

## 7. 自动化测试脚本

### 7.1 E2E 测试

使用 Playwright 或 Cypress 进行端到端测试：

```javascript
// 示例：测试搜索功能
test('搜索功能测试', async ({ page }) => {
  await page.goto('/customers');
  await page.fill('input[placeholder="搜索姓名/手机号"]', '张');
  await page.waitForSelector('.ant-table-row');
  const rows = await page.locator('.ant-table-row').count();
  expect(rows).toBeGreaterThan(0);
});
```

### 7.2 单元测试

使用 Jest 和 React Testing Library 进行组件测试：

```javascript
// 示例：测试客户列表组件
test('客户列表渲染测试', () => {
  render(<CustomersPage />);
  expect(screen.getByText('客户档案管理')).toBeInTheDocument();
});
```

## 8. 测试报告

### 8.1 测试结果记录

| 测试项目 | 测试结果 | 备注 |
|---------|---------|------|
| 搜索功能 | ✅ 通过 | - |
| 分类筛选 | ✅ 通过 | - |
| 产品筛选 | ✅ 通过 | - |
| 年龄筛选 | ✅ 通过 | - |
| 权限控制 | ✅ 通过 | - |
| 响应式布局 | ✅ 通过 | - |
| 图表性能 | ✅ 通过 | - |

### 8.2 问题记录

| 问题编号 | 问题描述 | 严重程度 | 状态 |
|---------|---------|---------|------|
| BUG-001 | 无 | - | - |

## 9. 测试环境

- **开发环境：** http://localhost:3001
- **测试数据：** Mock 数据（100+ 客户记录）
- **测试账号：**
  - 角色：medical_assistant（ID: 1）
  - 角色：optometrist（ID: 3）
  - 角色：manager（ID: 6）
  - 角色：executive（ID: 7）

## 10. 测试注意事项

1. 测试前请确保开发服务器正在运行
2. 测试权限功能需要先登录系统
3. 测试响应式布局时注意清除浏览器缓存
4. 测试图表性能时注意观察控制台日志
5. 测试过程中如发现问题，请截图并记录详细步骤
